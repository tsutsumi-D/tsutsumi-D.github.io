<template>
  <div>
    <div>
      <canvas
        ref="canvas"
        class="canvas"
        :width="size.width"
        :height="size.height"
        @mousedown="handleMouseDown"
        @mouseup="handleMouseUp"
        @mousemove="handleMouseMove"
      ></canvas>
    </div>
    <a class="button" @click="clear">clear</a>
  </div>
</template>

<style scoped>
.canvas {
  background-color: #000; /*黒背景*/
}
</style>

<script>
export default {
  data() {
    return {
      size: {
        width: 400,
        height: 400,
      },
      mouse: {
        x: 0,
        y: 0,
        down: false,
      },
    };
  },
  computed: {
    currentMouse() {
      const c = this.$refs.canvas;
      const rect = c.getBoundingClientRect();

      return {
        x: this.mouse.x - rect.left,
        y: this.mouse.y - rect.top,
      };
    },
  },
  mounted() {
    this.clear();
  },
  methods: {
    draw() {
      if (this.mouse.down) {
        const ctx = this.$refs.canvas.getContext('2d');
        ctx.lineTo(this.currentMouse.x, this.currentMouse.y);
        ctx.strokeStyle = '#fff'; // 白文字
        ctx.lineWidth = 20;
        ctx.stroke();
      }
    },
    handleMouseDown(event) {
      this.mouse = {
        x: event.pageX,
        y: event.pageY,
        down: true,
      };

      const ctx = this.$refs.canvas.getContext('2d');
      ctx.moveTo(this.currentMouse.x, this.currentMouse.y);
    },
    handleMouseUp() {
      this.mouse.down = false;
    },
    handleMouseMove(event) {
      Object.assign(this.mouse, {
        x: event.pageX,
        y: event.pageY,
      });

      this.draw();
    },
    clear() {
      const ctx = this.$refs.canvas.getContext('2d');
      ctx.clearRect(0, 0, this.size.width, this.size.height);
      ctx.beginPath();
    },
  },
};
</script>